(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{197:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),s("ul",[t._m(2),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://developers.weixin.qq.com/doc/",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信官方文档链接"),s("OutboundLink")],1),t._v(" => 进入公众号开发 => 左侧菜单栏进入"),s("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信网页开发"),s("OutboundLink")],1)])])]),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("根据JS SDK的步骤指引，完成前3步；这里不再赘述；这里有几个需要注意的点")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),s("ul",[t._m(6),t._v(" "),s("li",[s("p",[t._v("直接看JSSDK使用步骤的第三步wx.config配置需要签名相关的数据，下面介绍获取签名的步骤(微信的官方文档更加详细，我这边列出了大概的步骤; "),s("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文"),s("OutboundLink")],1),t._v(")")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("获取access_token "),s("a",{attrs:{href:"https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Get_access_token.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信open api接口"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("根据access_token获取jsapi_ticket "),s("a",{attrs:{href:"https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token=ACCESS_TOKEN&type=jsapi",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信open api接口"),s("OutboundLink")],1)])]),t._v(" "),t._m(7),t._v(" "),t._m(8)]),t._v(" "),t._m(9)])]),t._v(" "),t._m(10),t._v(" "),t._m(11)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"微信分享：node作为服务端微信签名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信分享：node作为服务端微信签名","aria-hidden":"true"}},[this._v("#")]),this._v(" 微信分享：node作为服务端微信签名")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"需求背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需求背景","aria-hidden":"true"}},[this._v("#")]),this._v(" 需求背景")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("p",[this._v("之前有个h5活动页的开发，后端大佬们他们那边只需要提供下微信签名的接口，所以前端团队这边就决定自己用node层作为服务端做掉了")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"客户端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端","aria-hidden":"true"}},[this._v("#")]),this._v(" 客户端")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("appSecret需要超管生成，生成后需要保存")]),this._v(" "),e("li",[this._v("需要配置jsApiList")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"服务端"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务端","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务端")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("p",[this._v("几个核心的包 koa + koa-router + sha1")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("p",[this._v("access_token和jsapi_ticket需要缓存，原因是jsapi_ticket有调用次数限制，并且也有时效性，没有必要实时获取")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("p",[this._v("获取签名")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 参数顺序必须严格按照这个")]),t._v("\nstr "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" jsapi_ticket"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("jsapi_ticket"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("noncestr"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("noncestr"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("timestamp"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("timestamp"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("url"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("url"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nsignature "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token function"}},[t._v("sha1")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// jsapi_ticket： 上面获取的")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// noncestr: 随机字符串")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// timestamp: Date.parse(new Date())) / 1000 注意：这里是秒时间戳，不是毫秒时间戳")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// url: domain + '/' (domain:步骤一中公众号后台绑定的域名；或者客户端传过来: location.href.split('#')[0]，这样可以保证域名后面有个'/')  ")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#说明","aria-hidden":"true"}},[this._v("#")]),this._v(" 说明")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("服务端签名的url参数，我之前是在服务单写死的域名，尾部缺少'/'，导致签名一直错误")]),this._v(" "),e("li",[this._v("调用微信open api,需要借助node内置库https(不是http)，否则会一直抛 'socket hangup'")]),this._v(" "),e("li",[this._v("本地开发访问的域名需要与线上的域名保持一致, 可以用nginx + 绑hosts的方式")]),this._v(" "),e("li",[this._v("具体开发的时候，建议参考微信官方文档，更详细些而且后续sdk升级，一些配置也会变，本文记录的是一些大概的实现和遇到的几个坑")])])}],!1,null,null,null);n.options.__file="wechat.md";e.default=n.exports}}]);